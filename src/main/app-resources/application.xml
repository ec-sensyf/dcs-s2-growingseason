<application id="growingseason">
  <jobTemplates>
    <jobTemplate id="jt_echo">
      <streamingExecutable>/application/growingseason/bin/py_echo</streamingExecutable>
      <defaultParameters>
	<parameter id="toyparam">FirstParam</parameter>
	<parameter id="toy-parameter">SecondParamDefault</parameter>
	<parameter id="mode">all</parameter>
	<parameter id="startdate">1900-07-04</parameter>
	<parameter id="enddate">2025-08-03</parameter>
	<parameter id="othreshold">0.7</parameter>
	<parameter id="ethreshold">0.9</parameter>
      </defaultParameters>
      <defaultJobconf>
        <property id="mapred.task.timeout">3600000</property> <!-- in milliseconds -->
	<property id="ciop.job.max.tasks">1</property>
      </defaultJobconf>
    </jobTemplate>
    <jobTemplate id="jt_mapped_tiling">
      <streamingExecutable>/application/growingseason/run_map_tiling</streamingExecutable>
      <defaultParameters>
	<parameter id="tilesize">1024</parameter>
      </defaultParameters>
      <defaultJobconf>
        <property id="mapred.task.timeout">3600000</property> <!-- in milliseconds -->
	<property id="ciop.job.max.tasks">10</property>	<!-- mapper -->
      </defaultJobconf>
    </jobTemplate>
    <jobTemplate id="jt_grouping">
      <streamingExecutable>/application/growingseason/run_grouping</streamingExecutable>
      <defaultParameters>
	<parameter id="tilesize">1024</parameter>
      </defaultParameters>
      <defaultJobconf>
        <property id="mapred.task.timeout">3600000</property> <!-- in milliseconds -->
	<property id="ciop.job.max.tasks">1</property>	<!-- reducer -->
      </defaultJobconf>
    </jobTemplate>
    <jobTemplate id="jt_s2job">
      <streamingExecutable>/application/growingseason/run_s2wf</streamingExecutable>
      <defaultParameters>
	<parameter id="mode">all</parameter>
	<parameter id="startdate">1925-07-04</parameter>
	<parameter id="enddate">2025-08-03</parameter>
	<parameter id="othreshold">0.7</parameter>
	<parameter id="ethreshold">0.9</parameter>
      </defaultParameters>
      <defaultJobconf>
        <property id="mapred.task.timeout">3600000</property> <!-- in milliseconds -->
	<property id="ciop.job.max.tasks">10</property>
      </defaultJobconf>
    </jobTemplate>
    <jobTemplate id="jt_s2pyjob">
      <streamingExecutable>/application/growingseason/bin/s2_processtile.py</streamingExecutable>
      <defaultParameters>
	<parameter id="mode">all</parameter>
	<parameter id="startdate-onset">1925-07-04</parameter>
	<parameter id="enddate-onset">2025-08-03</parameter>
	<parameter id="othreshold">0.7</parameter>
	<parameter id="ethreshold">0.9</parameter>
      </defaultParameters>
      <defaultJobconf>
        <property id="mapred.task.timeout">3600000</property> <!-- in milliseconds -->
	<property id="ciop.job.max.tasks">10</property>
      </defaultJobconf>
    </jobTemplate>
    <jobTemplate id="jt_merge">
      <streamingExecutable>/application/growingseason/merge_tiles</streamingExecutable>
      <defaultJobconf>
        <property id="mapred.task.timeout">3600000</property> <!-- in milliseconds -->
	<property id="ciop.job.max.tasks">1</property>	<!-- reducer -->
      </defaultJobconf>
    </jobTemplate>
  </jobTemplates>
 <workflow id="wf_growingseason">
    <workflowVersion>1.0</workflowVersion>
    <node id="maptiling">
      <job id="jt_mapped_tiling"/>
      <sources>
	<source refid="cas:series">http://sensyf.terradue.int/catalogue/search/MODIS_NDVI/description</source>
      </sources>
      <parameters>
	<parameter id="tilesize">1024</parameter>
	<!-- <parameter id="tilesize">512</parameter> -->
      </parameters>
    </node>
    <node id="grouping">
      <job id="jt_grouping"/>
      <sources>
	<source refid="wf:node">maptiling</source>
      </sources>
    </node>
    <node id="process_tiled">
      <job id="jt_s2pyjob"/>
      <sources>
	<source refid="wf:node">grouping</source>
      </sources>
      <parameters>
	<parameter id="mode">all</parameter>
	<parameter id="startdate">1945-07-04</parameter>
	<parameter id="enddate">2045-08-03</parameter>
	<parameter id="othreshold">0.7</parameter>
	<parameter id="ethreshold">0.9</parameter>
      </parameters>
    </node>
    <node id="merge">
      <job id="jt_merge"/>
      <sources>
	<source refid="wf:node">process_tiled</source>
      </sources>
    </node>
    <node id="end">
      <job id="jt_echo"/>
      <sources>
	<source refid="wf:node">end_merged</source>
      </sources>
      <parameters>
	<parameter id="toy-parameter">SecondParamOverridden</parameter>
      </parameters>
    </node>
  </workflow>
</application>
